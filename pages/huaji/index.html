<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <style type="text/css">
        body {
            padding:0;
            margin:0;
        }
        canvas {

        }
    </style>
</head>
<body>
    <div>
        <canvas id="canvas">您的浏览器不支持 HTML5 canvas 标签。</canvas>
    </div>
    

    <script type="text/javascript">
        var screenWidth = window.innerWidth;
        var screenHeight =window.innerHeight - 5;

        //获得画布元素
        var canvas = document.getElementById('canvas');
        canvas.setAttribute("width",screenWidth);
         canvas.setAttribute("height",screenHeight);
        var panel = canvas.getContext('2d');
        canvas.addEventListener("touchmove",function(e){ e.preventDefault(); });

        var referenceList = [];

        //视角距离
        var perspective = 50

        function DrawImg(x, y, width, height, z) {
            x = x - width / 2;
            y = y - height / 2;

            var scale = (z )/ perspective
            var x = (x - screenWidth / 2) * scale + screenWidth / 2
            var y = (y - screenHeight / 2) * scale + screenHeight / 2
                       
            referenceList.push({
                zIndex: z, func: function () {
                    var img = new Image();
                    img.src = "face.jpg";
                    panel.drawImage(img, x, y, width * scale, height * scale);  
                }
            });
        }
        
        if (!window.requestAnimationFrame) {
            window.requestAnimationFrame = (window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.oRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                function (callback) {
                    var self = this, start, finish;
                    return window.setTimeout(function () {
                        start = +new Date();
                        callback(start);
                        finish = +new Date();
                        self.timeout = 1000 / 60 - (finish - start);
                    }, self.timeout);
                });
        }

        //清除画布     
        function clearCanvas() {
            window.requestAnimationFrame(clearCanvas);
            panel.clearRect(0, 0, screenWidth, screenHeight);//   

            referenceList.sort(function (a, b) {
                if (a.zIndex > b.zIndex) {
                    return 1;
                }
                else {
                    return -1;
                }
            });

            for (var i in referenceList) {
                referenceList[i].func();
            }

            referenceList = [];
        }
        window.requestAnimationFrame(clearCanvas);

        //创建点
        function create(pointX,pointY) {

            var counter = 15;

            var animation = function () {
                if (counter > 1000) {
                    return;
                }

                window.requestAnimationFrame(animation);

                counter += (1 / 60);

                DrawImg(pointX, pointY, 100,100, counter);
                //new Ball(pointX, pointY, counter, 50).render();
            };
            window.requestAnimationFrame(animation);
        }
       
        //获取随机数
        function random(start, end) {
            return parseInt(Math.random(0, 1) * (end - start) + start);
        }


        //清除画布     
        function randomCreate() {

            var basePointX = screenWidth / 2+410;
            var basePointY = screenHeight / 2+410;

            var counter = 10;
            for (var i = -counter / 2; i <= counter / 2; i++) {
                for (var j = -counter / 2; j <= counter / 2; j++) {
 
                    create(basePointX + j * 1000, basePointY + i * 1000);
                }
            }

            setTimeout(function () {
                randomCreate();
            }, 10000);
        }
        randomCreate();



      
    </script>
</body>
</html>
